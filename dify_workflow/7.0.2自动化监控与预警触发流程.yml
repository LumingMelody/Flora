app:
  description: Ëá™Âä®ÂåñÁõëÊéß‰∏éÈ¢ÑË≠¶Ëß¶ÂèëÊµÅÁ®ã
  icon: üö®
  icon_background: '#FEF7C3'
  mode: workflow
  name: 7.0.2Ëá™Âä®ÂåñÁõëÊéß‰∏éÈ¢ÑË≠¶Ëß¶ÂèëÊµÅÁ®ã
  use_icon_as_answer_icon: false
dependencies:
- current_identifier: null
  type: marketplace
  value:
    marketplace_plugin_unique_identifier: langgenius/tongyi:0.1.3@08f25a10c0617a3512fac091a0f0d894925357e965efe40fdf95cb48e09b62d1
    version: null
kind: app
version: 0.4.0
workflow:
  conversation_variables: []
  environment_variables: []
  features:
    file_upload:
      allowed_file_extensions:
      - .JPG
      - .JPEG
      - .PNG
      - .GIF
      - .WEBP
      - .SVG
      allowed_file_types:
      - image
      allowed_file_upload_methods:
      - local_file
      - remote_url
      enabled: false
      fileUploadConfig:
        audio_file_size_limit: 50
        batch_count_limit: 5
        file_size_limit: 15
        image_file_size_limit: 10
        video_file_size_limit: 100
        workflow_file_upload_limit: 10
      image:
        enabled: false
        number_limits: 3
        transfer_methods:
        - local_file
        - remote_url
      number_limits: 3
    opening_statement: ''
    retriever_resource:
      enabled: false
    sensitive_word_avoidance:
      enabled: false
    speech_to_text:
      enabled: false
    suggested_questions: []
    suggested_questions_after_answer:
      enabled: false
    text_to_speech:
      enabled: false
      language: ''
      voice: ''
  graph:
    edges:
    - data:
        sourceType: http-request
        targetType: end
      id: edge-http-to-end
      source: http-save
      sourceHandle: source
      target: end
      targetHandle: target
      type: custom
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: llm
        targetType: code
      id: 1765271515676-source-1765271523467-target
      source: '1765271515676'
      sourceHandle: source
      target: '1765271523467'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: code
        targetType: http-request
      id: 1765271523467-source-http-save-target
      source: '1765271523467'
      sourceHandle: source
      target: http-save
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: start
        targetType: http-request
      id: start-source-1765272559257-target
      source: start
      sourceHandle: source
      target: '1765272559257'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: http-request
        targetType: llm
      id: 1765272559257-source-1765271515676-target
      source: '1765272559257'
      sourceHandle: source
      target: '1765271515676'
      targetHandle: target
      type: custom
      zIndex: 0
    nodes:
    - data:
        desc: ËæìÂÖ•ÂÆ¢Êà∑Êï∞ÊçÆ
        selected: false
        title: ÂºÄÂßã
        type: start
        variables:
        - label: ‰∫ßÂìÅÂêç
          max_length: 48
          options: []
          required: true
          type: text-input
          variable: e_product_id_name
        - label: ‰∫ßÂìÅÁÆÄ‰ªã
          max_length: 256
          options: []
          required: true
          type: paragraph
          variable: e_product_id_detail
        - label: ‰∫ßÂìÅÂ∫èÂè∑
          max_length: 48
          options: []
          required: true
          type: text-input
          variable: e_product_id
        - label: ÂÆ¢Êà∑ID
          max_length: 48
          options: []
          required: true
          type: text-input
          variable: customer_id
        - label: ‰ºÅ‰∏öÂêç
          max_length: 48
          options: []
          required: true
          type: text-input
          variable: e_company_name
        - label: ‰ºÅ‰∏öÂπ¥Êî∂ÂÖ•
          max_length: 48
          options: []
          required: true
          type: text-input
          variable: e_company_revenue
        - label: Áî®Êà∑id
          max_length: 48
          options: []
          required: true
          type: text-input
          variable: user_id
        - label: ÁßüÊà∑id
          max_length: 48
          options: []
          required: true
          type: text-input
          variable: tenant_id
        - label: ‰ªªÂä°id
          max_length: 48
          options: []
          required: true
          type: text-input
          variable: taskId
      height: 324
      id: start
      position:
        x: 80
        y: 282
      positionAbsolute:
        x: 80
        y: 282
      selected: false
      type: custom
      width: 242
    - data:
        authorization:
          config: null
          type: no-auth
        body:
          data:
          - id: key-value-1
            key: ''
            type: text
            value: "{\n  \"customerId\":\"{{#start.customer_id#}}\",\n  \"workflowTaskId\"\
              :\"{{#start.taskId#}}\",\n  \"usageData\":\"{{#1765271523467.usageData#}}\"\
              ,\n  \"interactionData\":\"{{#1765271523467.interactionData#}}\",\n\
              \  \"commercialData\":\"{{#1765271523467.commercialData#}}\",\n  \"\
              calculatedScores\":\"{{#1765271523467.calculatedScores#}}\",\n  \"totalScore\"\
              :\"{{#1765271515676.structured_output.totalScore#}}\",\n  \"scoreChange\"\
              :\"{{#1765271515676.structured_output.scoreChange#}}\",\n  \"healthLevel\"\
              :\"{{#1765271515676.structured_output.healthLevel#}}\",\n  \"levelChange\"\
              :\"{{#1765271515676.structured_output.levelChange#}}\",\n  \"alertTriggered\"\
              :‚Äù{{#1765271515676.structured_output.alertTriggered#}}\",\n  \"alertType\"\
              :\"{{#1765271515676.structured_output.alertType#}}\",\n  \"alertLevel\"\
              :\"{{#1765271515676.structured_output.alertLevel#}}\",\n  \"alertReason\"\
              :\"{{#1765271515676.structured_output.alertReason#}}\",\n  \"alertDetails\"\
              :\"{{#1765271523467.alertDetails#}}\",\n  \"notificationRecipients\"\
              :\"{{#1765271523467.notificationRecipients#}}\",\n  \"notificationChannels\"\
              :\"{{#1765271523467.notificationChannels#}}\",\n  \"recommendedResponse\"\
              :\"{{#1765271515676.structured_output.recommendedResponse#}}\",\n  \"\
              responseSlaHours\":\"{{#1765271515676.structured_output.responseSlaHours#}}\"\
              \n}"
          type: json
        headers: 'Authorization:test{{#start.user_id#}}

          tenant-id:{{#start.tenant_id#}}'
        method: post
        params: ''
        retry_config:
          max_retries: 3
          retry_enabled: true
          retry_interval: 100
        selected: false
        ssl_verify: true
        timeout:
          max_connect_timeout: 0
          max_read_timeout: 0
          max_write_timeout: 0
        title: HTTP ËØ∑Ê±Ç
        type: http-request
        url: https://agent.cstlanbaai.com/gateway/admin-api/scrm/health-alert-trigger/create
        variables: []
      height: 171
      id: http-save
      position:
        x: 1056
        y: 282
      positionAbsolute:
        x: 1056
        y: 282
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        desc: ËæìÂá∫ÁªìÊûú
        outputs:
        - value_selector:
          - http-save
          - body
          value_type: string
          variable: alert_trigger_result
        selected: false
        title: ÁªìÊùü
        type: end
      height: 117
      id: end
      position:
        x: 1396
        y: 275
      positionAbsolute:
        x: 1396
        y: 275
      selected: false
      type: custom
      width: 242
    - data:
        context:
          enabled: false
          variable_selector: []
        model:
          completion_params:
            temperature: 0.7
          mode: chat
          name: qwen3-max
          provider: langgenius/tongyi/tongyi
        prompt_template:
        - id: 50de0c2d-ad7b-4560-9c47-baea11127440
          role: system
          text: "ËØ∑‰Ω†‰Ωú‰∏∫‰∏ÄÂêç‰∏ì‰∏öÁöÑÂÆ¢Êà∑ÂÅ•Â∫∑Â∫¶ÁõëÊéß‰∏ìÂÆ∂ÔºåÊâßË°åËá™Âä®ÂåñÁõëÊéß‰∏éÈ¢ÑË≠¶Ëß¶ÂèëÔºö\n\n„Äê‰∏Ä„ÄÅÂÆûÊó∂Êï∞ÊçÆÈááÈõÜ‰∏éÁõëÊéß„Äë\n1. ‰ΩøÁî®Êï∞ÊçÆÈááÈõÜÔºöÁôªÂΩïË°å‰∏∫„ÄÅÂäüËÉΩ‰ΩøÁî®„ÄÅÊÄßËÉΩ‰ΩìÈ™å\n\
            2. ‰∫§‰∫íÊï∞ÊçÆÈááÈõÜÔºöÊîØÊåÅÂ∑•Âçï„ÄÅÊ≤üÈÄöËÆ∞ÂΩï„ÄÅÂèçÈ¶àËØÑ‰ª∑\n3. ÂïÜ‰∏öÊï∞ÊçÆÈááÈõÜÔºöÂêàÂêåÁä∂ÊÄÅ„ÄÅË¥¶Ê¨æÁä∂ÊÄÅ„ÄÅÂ¢ûË¥≠ËÆ∞ÂΩï\n\n„Äê‰∫å„ÄÅÂÅ•Â∫∑Â∫¶ËÆ°ÁÆó‰∏éËØÑ‰º∞„Äë\n1.\
            \ ÂÆûÊó∂ÂÅ•Â∫∑Â∫¶ËØÑÂàÜÔºöÂêÑÁª¥Â∫¶ÂæóÂàÜ„ÄÅÁªºÂêàÂæóÂàÜ„ÄÅË∂ãÂäøÂØπÊØî\n2. ÂÅ•Â∫∑Á≠âÁ∫ßÂà§ÂÆöÔºöÂΩìÂâçÁ≠âÁ∫ß„ÄÅÁ≠âÁ∫ßÂèòÂåñ„ÄÅË∂ãÂäøÈ¢ÑÊµã\n\n„Äê‰∏â„ÄÅÈ¢ÑË≠¶ËßÑÂàô‰∏éËß¶Âèë„Äë\n1.\
            \ ÈòàÂÄºÈ¢ÑË≠¶ÔºàTHRESHOLDÔºâÔºöÁªºÂêàÂæóÂàÜ„ÄÅÂçïÈ°πÊåáÊ†á„ÄÅÁ≠âÁ∫ßÂèòÂåñ\n2. Ë∂ãÂäøÈ¢ÑË≠¶ÔºàTRENDÔºâÔºöËøûÁª≠‰∏ãÈôç„ÄÅÊòæËëó‰∏ãÈôç„ÄÅÂºÇÂ∏∏Ê≥¢Âä®\n3. ‰∫ã‰ª∂È¢ÑË≠¶ÔºàEVENTÔºâÔºöÂÖ≥ÈîÆÁî®Êà∑ÊµÅÂ§±„ÄÅÈáçÂ§ßÊäïËØâ„ÄÅÂêàÂêåÂà∞Êúü\n\
            \nËØ∑‰ª•JSONÊ†ºÂºèËæìÂá∫ÔºåÂåÖÂê´‰ª•‰∏ãÂ≠óÊÆµÔºö\n{ \n    \"customerId\": \"ÂÆ¢Êà∑ID\",\n    \"workflowTaskId\"\
            : \"‰ªªÂä°ID\",\n    \"usageData\": {\"loginFrequency\": \"\", \"featureUsage\"\
            : \"\", \"performanceExperience\": \"\"},\n    \"interactionData\": {\"\
            supportTickets\": \"\", \"communicationRecords\": \"\", \"feedbackRatings\"\
            : \"\"},\n    \"commercialData\": {\"contractStatus\": \"\", \"paymentStatus\"\
            : \"\", \"expansionRecords\": \"\"},\n    \"calculatedScores\": {\"usageScore\"\
            : 0, \"interactionScore\": 0, \"commercialScore\": 0},\n    \"totalScore\"\
            : 85,\n    \"scoreChange\": -5,\n    \"healthLevel\": \"GREEN/YELLOW/RED\"\
            ,\n    \"levelChange\": \"STABLE/UP/DOWN\",\n    \"alertTriggered\": 0=Âê¶Ôºå1=ÊòØ,\n\
            \    \"alertType\": \"THRESHOLD/TREND/EVENT\",\n    \"alertLevel\": \"\
            INFO/WARNING/CRITICAL\",\n    \"alertReason\": \"È¢ÑË≠¶ÂéüÂõ†ÊèèËø∞\",\n    \"alertDetails\"\
            : {\"metric\": \"\", \"threshold\": 0, \"currentValue\": 0},\n    \"notificationRecipients\"\
            : [\"recipient1\"],\n    \"notificationChannels\": [\"email\", \"sms\"\
            ],\n    \"recommendedResponse\": \"Âª∫ËÆÆÂìçÂ∫îÊé™ÊñΩ\",\n    \"responseSlaHours\"\
            : 24 \n}\n"
        - id: 19e452b9-13e3-41ac-bc17-d489fac99d69
          role: user
          text: '‰ª•‰∏ãÊòØÂÆ¢Êà∑‰ø°ÊÅØÔºö

            - ‰∫ßÂìÅÂêçÁß∞Ôºö{{#start.e_product_id_name#}}

            - ‰ºÅ‰∏öÂêçÁß∞Ôºö{{#start.e_company_name#}}

            - ‰ºÅ‰∏öÂπ¥Ëê•Êî∂ËßÑÊ®°Ôºö{{#start.e_company_revenue#}}ÂÖÉ

            - ‰∫ßÂìÅ‰∏ªË¶ÅÂäüËÉΩÔºö{{#start.e_product_id_detail#}}

            - ÂÆ¢Êà∑IDÔºö{{#start.customer_id#}}

            - ‰ªªÂä°IDÔºö{{#start.taskId#}}


            „ÄêÂÅ•Â∫∑Â∫¶ÊåáÊ†á‰ΩìÁ≥ªËÆæËÆ°ÁªìÊûú„ÄëÔºö

            {{#1765272559257.body#}}


            ËØ∑Âü∫‰∫é‰ª•‰∏äÊåáÊ†á‰ΩìÁ≥ªÊâßË°åËá™Âä®ÂåñÁõëÊéßÂπ∂Âà§Êñ≠ÊòØÂê¶ÈúÄË¶ÅËß¶ÂèëÈ¢ÑË≠¶„ÄÇÊ≥®ÊÑèÂú®ËæìÂá∫ÁöÑJSON‰∏≠ÂåÖÂê´customerIdÂíåworkflowTaskIdÂ≠óÊÆµ„ÄÇ

            '
        selected: false
        structured_output:
          schema:
            additionalProperties: false
            properties:
              alertDetails:
                additionalProperties: false
                properties:
                  currentValue:
                    type: number
                  metric:
                    type: string
                  threshold:
                    type: number
                required:
                - metric
                - threshold
                - currentValue
                type: object
              alertLevel:
                type: string
              alertReason:
                type: string
              alertTriggered:
                type: string
              alertType:
                type: string
              calculatedScores:
                additionalProperties: false
                properties:
                  commercialScore:
                    type: number
                  interactionScore:
                    type: number
                  usageScore:
                    type: number
                required:
                - usageScore
                - interactionScore
                - commercialScore
                type: object
              commercialData:
                additionalProperties: false
                properties:
                  contractStatus:
                    type: string
                  expansionRecords:
                    type: string
                  paymentStatus:
                    type: string
                required:
                - contractStatus
                - paymentStatus
                - expansionRecords
                type: object
              customerId:
                type: string
              healthLevel:
                type: string
              interactionData:
                additionalProperties: false
                properties:
                  communicationRecords:
                    type: string
                  feedbackRatings:
                    type: string
                  supportTickets:
                    type: string
                required:
                - supportTickets
                - communicationRecords
                - feedbackRatings
                type: object
              levelChange:
                type: string
              notificationChannels:
                items:
                  type: string
                type: array
              notificationRecipients:
                items:
                  type: string
                type: array
              recommendedResponse:
                type: string
              responseSlaHours:
                type: number
              scoreChange:
                type: number
              totalScore:
                type: number
              usageData:
                additionalProperties: false
                properties:
                  featureUsage:
                    type: string
                  loginFrequency:
                    type: string
                  performanceExperience:
                    type: string
                required:
                - loginFrequency
                - featureUsage
                - performanceExperience
                type: object
              workflowTaskId:
                type: string
            required:
            - customerId
            - workflowTaskId
            - usageData
            - interactionData
            - commercialData
            - calculatedScores
            - totalScore
            - scoreChange
            - healthLevel
            - levelChange
            - alertTriggered
            - alertType
            - alertLevel
            - alertReason
            - alertDetails
            - notificationRecipients
            - notificationChannels
            - recommendedResponse
            - responseSlaHours
            type: object
        structured_output_enabled: true
        title: ÁõëÊéß‰∏éÈ¢ÑË≠¶
        type: llm
        vision:
          enabled: false
      height: 88
      id: '1765271515676'
      position:
        x: 682
        y: 282
      positionAbsolute:
        x: 682
        y: 282
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        code: "import json\ndef main(usageData: dict, interactionData: dict, commercialData:\
          \ dict, calculatedScores: dict, alertDetails: dict, notificationRecipients:\
          \ list, notificationChannels: list) -> dict:\n    result = {\n        \"\
          usageData\": \"\",\n        \"interactionData\": \"\",\n        \"commercialData\"\
          : \"\",\n        \"calculatedScores\": \"\",\n        \"alertDetails\":\
          \ \"\",\n        \"notificationRecipients\": \"\",\n        \"notificationChannels\"\
          : \"\"\n    }\n    try:\n        json_str = json.dumps(usageData, ensure_ascii=False,\
          \ separators=(',', ':'))\n        result[\"usageData\"] = json.dumps(json_str,\
          \ ensure_ascii=False)\n\n        json_str = json.dumps(interactionData,\
          \ ensure_ascii=False, separators=(',', ':'))\n        result[\"interactionData\"\
          ] = json.dumps(json_str, ensure_ascii=False)\n\n        json_str = json.dumps(commercialData,\
          \ ensure_ascii=False, separators=(',', ':'))\n        result[\"commercialData\"\
          ] = json.dumps(json_str, ensure_ascii=False)\n\n        json_str = json.dumps(calculatedScores,\
          \ ensure_ascii=False, separators=(',', ':'))\n        result[\"calculatedScores\"\
          ] = json.dumps(json_str, ensure_ascii=False)\n\n        json_str = json.dumps(alertDetails,\
          \ ensure_ascii=False, separators=(',', ':'))\n        result[\"alertDetails\"\
          ] = json.dumps(json_str, ensure_ascii=False)\n\n        json_str = json.dumps(notificationRecipients,\
          \ ensure_ascii=False, separators=(',', ':'))\n        result[\"notificationRecipients\"\
          ] = json.dumps(json_str, ensure_ascii=False)\n\n        json_str = json.dumps(notificationChannels,\
          \ ensure_ascii=False, separators=(',', ':'))\n        result[\"notificationChannels\"\
          ] = json.dumps(json_str, ensure_ascii=False)\n\n    except Exception as\
          \ e:\n        pass\n    return result\n"
        code_language: python3
        outputs:
          alertDetails:
            children: null
            type: string
          calculatedScores:
            children: null
            type: string
          commercialData:
            children: null
            type: string
          interactionData:
            children: null
            type: string
          notificationChannels:
            children: null
            type: string
          notificationRecipients:
            children: null
            type: string
          usageData:
            children: null
            type: string
        selected: true
        title: ‰ª£Á†ÅÊâßË°å 2
        type: code
        variables:
        - value_selector:
          - '1765271515676'
          - structured_output
          - usageData
          value_type: object
          variable: usageData
        - value_selector:
          - '1765271515676'
          - structured_output
          - interactionData
          value_type: object
          variable: interactionData
        - value_selector:
          - '1765271515676'
          - structured_output
          - commercialData
          value_type: object
          variable: commercialData
        - value_selector:
          - '1765271515676'
          - structured_output
          - calculatedScores
          value_type: object
          variable: calculatedScores
        - value_selector:
          - '1765271515676'
          - structured_output
          - alertDetails
          value_type: object
          variable: alertDetails
        - value_selector:
          - '1765271515676'
          - structured_output
          - notificationRecipients
          value_type: object
          variable: notificationRecipients
        - value_selector:
          - '1765271515676'
          - structured_output
          - notificationChannels
          value_type: object
          variable: notificationChannels
      height: 52
      id: '1765271523467'
      position:
        x: 696
        y: 453
      positionAbsolute:
        x: 696
        y: 453
      selected: true
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        authorization:
          config: null
          type: no-auth
        body:
          data: []
          type: none
        headers: 'Authorization:test{{#start.user_id#}}

          tenant-id:{{#start.tenant_id#}}'
        method: get
        params: id:{{#start.taskId#}}
        retry_config:
          max_retries: 3
          retry_enabled: true
          retry_interval: 100
        selected: false
        ssl_verify: true
        timeout:
          max_connect_timeout: 0
          max_read_timeout: 0
          max_write_timeout: 0
        title: ÂÅ•Â∫∑ÊåáÊ†áËÆæËÆ°
        type: http-request
        url: https://agent.cstlanbaai.com/gateway/admin-api/scrm/health-metrics-design/get
        variables: []
      height: 155
      id: '1765272559257'
      position:
        x: 382
        y: 282
      positionAbsolute:
        x: 382
        y: 282
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    viewport:
      x: 281.5854992778193
      y: 78.94963500649294
      zoom: 0.5743491774985174
  rag_pipeline_variables: []
